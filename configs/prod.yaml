# ============================================
# 生产环境配置 (prod.yaml)
# ============================================
# 用途：线上生产环境
# 特点：高性能 + 高安全 + 日志归档 + 有状态会话
# ⚠️ 警告：所有标记 CHANGE-THIS 的值必须修改！
# ============================================

# ==================== 数据库配置 ====================
database:
  host: prod-mysql.youlai.tech  # ⚠️ 生产数据库地址（建议使用内网地址）
  port: 3306                    # MySQL 端口
  username: youlai_prod         # 生产数据库用户（仅必要权限，禁止 DROP/TRUNCATE）
  password: "CHANGE-THIS-IN-PRODUCTION"  # ⚠️ 必须修改！使用强密码（建议从 KMS/Vault 读取）
  dbname: youlai_boot           # 生产数据库名称
  charset: utf8mb4              # 字符集
  parseTime: true               # 自动解析时间
  loc: Local                    # 时区
  
  # 连接池配置（生产级配置）
  maxIdleConns: 50              # 最大空闲连接数（根据实际并发量调整）
  maxOpenConns: 500             # 最大打开连接数（不要超过 MySQL max_connections）
  connMaxLifetime: 3600         # 连接最大存活时间（1小时，避免 MySQL 8h 超时）

# ==================== 日志配置 ====================
logger:
  level: info                   # 日志级别：info（生产禁用 debug）
  
  # 控制台输出配置
  console:
    enabled: false              # ⚠️ 生产环境关闭控制台（避免污染标准输出）
    color: false                # 关闭彩色（Docker 日志不需要颜色）
    format: json                # JSON 格式（即使启用控制台也用 JSON）
  
  # 文件输出配置
  file:
    enabled: true               # ⚠️ 必须启用文件日志（生产唯一日志来源）
    path: /var/log/youlai/app.log       # 日志路径（建议挂载独立磁盘）
    maxSize: 500                # 单个文件 500MB（根据日志量调整）
    maxBackups: 30              # 保留 30 个备份文件
    maxAge: 30                  # 保留 30 天（根据合规要求调整）
    compress: true              # ⚠️ 必须压缩（节省磁盘空间，500MB → ~50MB）
    format: json                # ⚠️ 必须 JSON（便于 ELK/Loki 等日志系统解析）
    errorPath: /var/log/youlai/error.log  # 错误日志单独文件（便于告警）

# ==================== Redis 配置 ====================
redis:
  host: prod-redis.youlai.tech  # ⚠️ 生产 Redis 地址（建议主从/哨兵/集群）
  port: 6379                    # Redis 端口
  password: "prod-strong-password-change-me"  # ⚠️ 必须修改！强密码（建议从 KMS 读取）
  database: 0                   # Redis 数据库编号（生产建议独立实例，不共用）
  
  # 连接池配置（生产级大连接池）
  pool:
    maxIdle: 50                 # 最大空闲连接数（保持预热）
    maxActive: 500              # 最大活动连接数（根据实际 QPS 调整）
    minIdle: 20                 # 最小空闲连接数（避免冷启动）
  
  # 超时配置（秒）
  timeout:
    dial: 5                     # 建立连接超时
    read: 3                     # 读取超时（避免慢查询阻塞）
    write: 3                    # 写入超时
    pool: 5                     # 连接池获取超时

# ==================== 安全配置 ====================
security:
  sessionType: redis-token      # ⚠️ 生产推荐：redis-token（有状态，可即时失效）
  
  # JWT 配置（备用方案）
  jwt:
    secretKey: "CHANGE-THIS-IN-PRODUCTION-USE-KMS"  # ⚠️ 必须修改！建议 32+ 字符，从 KMS 读取
    accessTokenTTL: 7200        # 访问令牌有效期（2小时）
    refreshTokenTTL: 2592000    # 刷新令牌有效期（30天）
    enableSecurityVersion: true # ⚠️ 必须启用（密码修改后使旧 Token 失效）
  
  # Redis Token 配置（生产主用方案）
  redisToken:
    accessTokenTTL: 7200        # 访问令牌有效期（2小时）
    refreshTokenTTL: 2592000    # 刷新令牌有效期（30天）
    allowMultiLogin: false      # ⚠️ 生产禁止多设备（防账号共享）

# ==================== 生产环境部署清单 ====================
# 
# ✅ 部署前必查：
#   1. 修改所有 CHANGE-THIS 的值
#   2. 验证数据库连接（ping prod-mysql.youlai.tech）
#   3. 验证 Redis 连接（redis-cli -h prod-redis.youlai.tech）
#   4. 确保日志目录存在且有写权限（mkdir -p /var/log/youlai）
#   5. 配置日志轮转（logrotate）
# 
# ✅ 环境变量注入（推荐方式）：
#   export APP_DATABASE_PASSWORD="${PROD_DB_PASSWORD}"          # 从 Vault/KMS 读取
#   export APP_REDIS_PASSWORD="${PROD_REDIS_PASSWORD}"          # 从 Vault/KMS 读取
#   export APP_SECURITY_JWT_SECRETKEY="${PROD_JWT_SECRET}"      # 从 Vault/KMS 读取
# 
# ✅ Kubernetes ConfigMap/Secret：
#   apiVersion: v1
#   kind: Secret
#   metadata:
#     name: youlai-secrets
#   data:
#     database-password: <base64>      # 数据库密码
#     redis-password: <base64>         # Redis 密码
#     jwt-secret: <base64>             # JWT 密钥
# 
# ✅ Docker 部署：
#   docker run -d \
#     -e APP_ENV=prod \
#     -e APP_DATABASE_PASSWORD="${DB_PASS}" \
#     -e APP_REDIS_PASSWORD="${REDIS_PASS}" \
#     -v /var/log/youlai:/var/log/youlai \
#     youlai-gin:latest
# 
# ✅ 监控告警：
#   - 数据库连接池监控（maxOpenConns 使用率）
#   - Redis 连接池监控
#   - 错误日志告警（/var/log/youlai/error.log）
#   - Token 失效率监控
# 
# ✅ 安全加固：
#   - 数据库用户最小权限（禁止 DROP/ALTER）
#   - Redis 密码强度 16+ 字符
#   - JWT 密钥从 KMS/Vault 读取
#   - 定期轮转密钥（每季度）
#   - 启用 TLS（MySQL/Redis）
